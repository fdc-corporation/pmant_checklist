<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="checklist_template" name="Checklist Web Modal">
    <t t-call="website.layout">
      <div class="modal fade show" id="FormPmant" tabindex="-1" aria-modal="true" style="display:block;">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content shadow-lg rounded-3">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title">
                üìù Formulario de CheckList
              </h5>
            </div>
            <form id="checklist-form" method="POST" t-att-action="'/checklist/submit/%d/%d' % (equipo.id, plantilla.id)">
              <div class="modal-body">
                <t t-foreach="plantilla.line_questions" t-as="pregunta">
                  <div class="mb-4 pb-3 border-bottom">
                    <!-- Pregunta -->
                    <label class="form-label fw-semibold">
                      <t t-esc="pregunta.name" />
                    </label>

                    <!-- Respuesta tipo s√≠/no -->
                    <t t-if="pregunta.tipo_respuesta == 'si_no'">
                      <div class="form-check form-switch">
                        <input type="checkbox" class="form-check-input" t-att-name="'respuesta_%d_si_no' % pregunta.id" id="respuesta_si_no_${pregunta.id}" />
                        <label class="form-check-label" t-att-for="'respuesta_si_no_' + str(pregunta.id)">
                          S√≠
                        </label>
                      </div>
                    </t>

                    <!-- Respuesta tipo texto -->
                    <t t-if="pregunta.tipo_respuesta == 'texto'">
                      <textarea class="form-control mt-2" rows="2" t-att-name="'respuesta_%d_texto' % pregunta.id" placeholder="Escribe tu respuesta..."></textarea>
                    </t>

                    <!-- Comentario adicional -->
                    <div class="mt-3">
                      <label class="form-label">
                        ¬øTienes un comentario adicional?
                      </label>
                      <div class="form-check">
                        <input type="checkbox"
                          class="form-check-input toggle-comentario"
                          t-att-id="'comentario_chk_%d' % pregunta.id"
                          t-att-data-id="'%d' % pregunta.id"
                          t-att-name="'comentario_%d' % pregunta.id"
                        />
                        <label class="form-check-label" t-att-for="'comentario_chk_' + str(pregunta.id)">
                          Mostrar campo de comentario
                        </label>
                      </div>
                      <div t-att-id="'comentario_box_%d' % pregunta.id" class="comentario-box mt-2" style="display: none;">
                        <textarea class="form-control" rows="2" placeholder="Escribe tu comentario aqu√≠ (opcional)" t-att-name="'comentario_texto_%d' % pregunta.id"></textarea>
                      </div>
                    </div>
                  </div>
                </t>
              </div>

              <div class="modal-footer d-flex justify-content-between">
                <a t-att-href="'/my/equipos/' + str(equipo.id) + '/detalles'" class="btn btn-outline-secondary">
                  Cancelar
                </a>
                <button type="submit" class="btn btn-success">
                  Registrar Respuesta 
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- JS: mostrar/ocultar comentario -->
      <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function () {
          const checkboxes = document.querySelectorAll(".toggle-comentario");
          checkboxes.forEach(function (checkbox) {
            checkbox.addEventListener("change", function () {
              const preguntaId = checkbox.dataset.id;
              const comentarioBox = document.getElementById("comentario_box_" + preguntaId);
              comentarioBox.style.display = checkbox.checked ? "block" : "none";
            });
          });
        });
      </script>
    </t>
  </template>
</odoo>
